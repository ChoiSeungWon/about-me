<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring Boot에서 JPA 사용하기 | SeungWon 기술블로그</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/about-me/assets/css/0.styles.aad00d23.css" as="style"><link rel="preload" href="/about-me/assets/js/app.1fd5ee7f.js" as="script"><link rel="preload" href="/about-me/assets/js/7.be9fab67.js" as="script"><link rel="prefetch" href="/about-me/assets/js/10.a427f655.js"><link rel="prefetch" href="/about-me/assets/js/11.59b8b1ef.js"><link rel="prefetch" href="/about-me/assets/js/12.0a416c4b.js"><link rel="prefetch" href="/about-me/assets/js/13.4f90a351.js"><link rel="prefetch" href="/about-me/assets/js/14.9c5ecfe1.js"><link rel="prefetch" href="/about-me/assets/js/15.4af529ca.js"><link rel="prefetch" href="/about-me/assets/js/16.1a5022af.js"><link rel="prefetch" href="/about-me/assets/js/17.e32e52bb.js"><link rel="prefetch" href="/about-me/assets/js/18.18c05ca0.js"><link rel="prefetch" href="/about-me/assets/js/19.54bd122f.js"><link rel="prefetch" href="/about-me/assets/js/2.6be79372.js"><link rel="prefetch" href="/about-me/assets/js/20.5fe215a6.js"><link rel="prefetch" href="/about-me/assets/js/3.05835132.js"><link rel="prefetch" href="/about-me/assets/js/4.58042996.js"><link rel="prefetch" href="/about-me/assets/js/5.053d4dcf.js"><link rel="prefetch" href="/about-me/assets/js/6.bb492f85.js"><link rel="prefetch" href="/about-me/assets/js/8.f5703b5a.js"><link rel="prefetch" href="/about-me/assets/js/9.140de9e0.js">
    <link rel="stylesheet" href="/about-me/assets/css/0.styles.aad00d23.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/about-me/" class="home-link router-link-active"><!----> <span class="site-name">SeungWon 기술블로그</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about-me/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about-me/tech/" class="nav-link">Tech</a></div><div class="nav-item"><a href="/about-me/swchoi/" class="nav-link">about</a></div> <a href="https://github.com/ChoiSeungWon/about-me" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about-me/" class="nav-link">Home</a></div><div class="nav-item"><a href="/about-me/tech/" class="nav-link">Tech</a></div><div class="nav-item"><a href="/about-me/swchoi/" class="nav-link">about</a></div> <a href="https://github.com/ChoiSeungWon/about-me" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading open"><span>스프링 부트와 AWS로 혼자 구현하는 웹 서비스</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/about-me/spring/chater01/" class="sidebar-link">Gradle Spring Boot 프로젝트 생성</a></li><li><a href="/about-me/spring/chater02/" class="sidebar-link">Spring Boot 테스트 코드 작성</a></li><li><a href="/about-me/spring/chater03/" class="active sidebar-link">Spring Boot에서 JPA 사용하기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#_1-jpa-java-persistence-api-란" class="sidebar-link">1. JPA(Java Persistence API)란</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#orm-object-relational-mapping-이란" class="sidebar-link">ORM(Object-relational mapping) 이란</a></li></ul></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#_2-요구사항-분석" class="sidebar-link">2. 요구사항 분석</a></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#_3-spring-data-jpa-적용하기" class="sidebar-link">3. Spring Data JPA 적용하기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#entity-클래스-생성" class="sidebar-link">Entity 클래스 생성</a></li></ul></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#_4-spring-data-jpa-테스트-코드-작성하기" class="sidebar-link">4. Spring Data JPA 테스트 코드 작성하기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#쿼리-로그-추가" class="sidebar-link">쿼리 로그 추가</a></li></ul></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#_5-등록-수정-조회-api-만들기" class="sidebar-link">5. 등록/수정/조회 api 만들기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#등록" class="sidebar-link">등록</a></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#수정-조회" class="sidebar-link">수정/조회</a></li></ul></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#_6-jpa-auditing으로-생성시간-수정시간-자동화하기" class="sidebar-link">6. JPA Auditing으로 생성시간/수정시간 자동화하기</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#localdate-사용" class="sidebar-link">LocalDate 사용</a></li><li class="sidebar-sub-header"><a href="/about-me/spring/chater03/#jpa-auditing-테스트-코드-작성하기" class="sidebar-link">JPA Auditing 테스트 코드 작성하기</a></li></ul></li></ul></li><li><a href="/about-me/spring/chater04/" class="sidebar-link">Mustache로 화면 구성하기</a></li><li><a href="/about-me/spring/chater05/" class="sidebar-link">스프링 시큐리티와 OAuth 2.0으로 로그인 기능 구현하기</a></li><li><a href="/about-me/spring/chater06/" class="sidebar-link">AWS 서버 환경을 만들어보자</a></li><li><a href="/about-me/spring/chater07/" class="sidebar-link">AWS 데이터베이스 환경을 만들어보자</a></li><li><a href="/about-me/spring/chater08/" class="sidebar-link">EC2 서버에 스프링부트 배포</a></li><li><a href="/about-me/spring/chater09/" class="sidebar-link">Travis CI 배포 자동화</a></li><li><a href="/about-me/spring/chater10/" class="sidebar-link">NGINX 무중단 배포</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="spring-boot에서-jpa-사용하기"><a href="#spring-boot에서-jpa-사용하기" aria-hidden="true" class="header-anchor">#</a> Spring Boot에서 JPA 사용하기</h1> <h2 id="_1-jpa-java-persistence-api-란"><a href="#_1-jpa-java-persistence-api-란" aria-hidden="true" class="header-anchor">#</a> 1. JPA(Java Persistence API)란</h2> <ul><li><p>JPA는 여러 ORM 전문가가 참여한 EJB 3.0 스펙 작업에서 기존 EJB ORM이던 Entity Bean을 JPA라고 바꾸고 JavaSE, JavaEE를 위한 영속성(persistence) 관리와 ORM을 위한 표준 기술이다. JPA는 ORM 표준 기술로 Hibernate, OpenJPA, EclipseLink, TopLink Essentials과 같은 구현체가 있고 이에 표준 인터페이스가 바로 JPA이다.</p></li> <li><p>ORM(Object Relational Mapping)이란 RDB 테이블을 객체지향적으로 사용하기 위한 기술이다. RDB 테이블은 객체지향적 특징(상속, 다형성, 레퍼런스, 오브젝트 등)이 없고 자바와 같은 언어로 접근하기 쉽지 않다. 때문에 ORM을 사용해 오브젝트와 RDB 사이에 존재하는 개념과 접근을 객체지향적으로 다루기 위한 기술이다.</p></li></ul> <h4 id="장점"><a href="#장점" aria-hidden="true" class="header-anchor">#</a> 장점</h4> <ul><li>객체지향적으로 데이터를 관리할 수 있기 때문에 비즈니스 로직에 집중 할 수 있으며, 객체지향 개발이 가능하다.</li> <li>테이블 생성, 변경, 관리가 쉽다. (JPA를 잘 이해하고 있는 경우)</li> <li>로직을 쿼리에 집중하기 보다는 객체자체에 집중 할 수 있다.</li> <li>빠른 개발이 가능하다.</li></ul> <h4 id="단점"><a href="#단점" aria-hidden="true" class="header-anchor">#</a> 단점</h4> <ul><li>어렵다. 장점을 더 극대화 하기 위해서 알아야 할게 많다.</li> <li>잘 이해하고 사용하지 않으면 데이터 손실이 있을 수 있다. (persistence context)</li> <li>성능상 문제가 있을 수 있다.(이 문제 또한 잘 이해해야 해결이 가능하다.)</li></ul> <h3 id="orm-object-relational-mapping-이란"><a href="#orm-object-relational-mapping-이란" aria-hidden="true" class="header-anchor">#</a> ORM(Object-relational mapping) 이란</h3> <ul><li>Object-relational mapping (객체 관계 매핑)
<ul><li>객체는 객체대로 설계하고, 관계형 데이터베이스는 관계형 데이터베이스대로 설계한다.</li> <li>ORM 프레임워크가 중간에서 매핑해준다.</li></ul></li> <li>대중적인 언어에는 대부분 ORM 기술이 존재한다.</li> <li>ORM은 객체와 RDB <code>두 기둥 위에 있는 기술</code> 이다.</li></ul> <div class="language- extra-class"><pre class="language-text"><code>- MyBatis, iBatis는 ORM이 아니다. SQL Mapper입니다. 
- ORM은 객체를 매핑하는 것이고, SQL Mapper는 쿼리를 매핑하는 것이다.
</code></pre></div><h2 id="_2-요구사항-분석"><a href="#_2-요구사항-분석" aria-hidden="true" class="header-anchor">#</a> 2. 요구사항 분석</h2> <p>jpa 기능을 사용하여 게시판과 회원 기능을 구현한다.</p> <blockquote><p><code>post 기능</code></p> <ul><li><strong>post 조회</strong></li> <li><strong>post 등록</strong></li> <li><strong>post 수정</strong></li> <li><strong>post 삭제</strong></li></ul></blockquote> <blockquote><p><code>member 기능</code></p> <ul><li><strong>구글/ 네이버 로그인</strong></li> <li><strong>로그인한 사용자 글 작성 권한</strong></li> <li><strong>본인 작성 글에 대한 권한 관리</strong></li></ul></blockquote> <h2 id="_3-spring-data-jpa-적용하기"><a href="#_3-spring-data-jpa-적용하기" aria-hidden="true" class="header-anchor">#</a> 3. Spring Data JPA 적용하기</h2> <p>먼저 build.gradle에 다음과 같이 org.springframework.boot:spring-boot-stater-data-jpa와 com.h2database:h2 의존성들을 등록한다.</p> <div class="language- extra-class"><pre class="language-text"><code>dependencies {
    compile('org.springframework.boot:spring-boot-starter-web')
    compile('org.projectlombok:lombok')
    compile('org.springframework.boot:spring-boot-stater-data-jpa')
    compile('com.h2database:h2')
    testCompile('org.springframework.boot:spring-boot-starter-test')
}
</code></pre></div><h4 id="코드설명"><a href="#코드설명" aria-hidden="true" class="header-anchor">#</a> 코드설명</h4> <ol><li><strong>spring-boot-stater-data-jpa</strong> <ul><li>스프링 부트용 Spring Data Jpa 추상화 라이브러리</li> <li>스프링 부트 버전에 맞춰 자동으로 JPA관련 라이브러리들의 버전을 관리해준다.</li></ul></li> <li><strong>H2</strong> <ul><li>인메모리 관계형 데이터베이스</li> <li>별도의 설치가 필요 없이 프로젝트 의존성만으로 관리할 수 있다.</li> <li>메모리에서 실행되기 때문에 애플리케이션 재시작할 때마다 초기화된다.</li></ul></li></ol> <h3 id="entity-클래스-생성"><a href="#entity-클래스-생성" aria-hidden="true" class="header-anchor">#</a> Entity 클래스 생성</h3> <blockquote><p>Posts.class</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Getter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span><span class="token class-name">Column</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span><span class="token class-name">GeneratedValue</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span><span class="token class-name">GenerationType</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span><span class="token class-name">Id</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Posts</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Id</span>
    <span class="token annotation punctuation">@GeneratedValue</span><span class="token punctuation">(</span>strategy <span class="token operator">=</span> <span class="token class-name">GenerationType</span><span class="token punctuation">.</span>IDENTITY<span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>length <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Column</span><span class="token punctuation">(</span>columnDefinition <span class="token operator">=</span> <span class="token string">&quot;TEXT&quot;</span><span class="token punctuation">,</span> nullable <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Builder</span>
    <span class="token keyword">public</span> <span class="token class-name">Posts</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">String</span> author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> author<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="코드설명-2"><a href="#코드설명-2" aria-hidden="true" class="header-anchor">#</a> 코드설명</h4> <ol><li><strong>@Entity</strong> <ul><li>테이블과 링크될 클래스임을 나타낸다.</li> <li>기본값으로 크래스의 카멜케이스 이름을 언더 스커어 네이밍(_)으로 테이블 이름을 매칠한다.</li> <li>ex) SalesManager.java -&gt; sales_manager table</li></ul></li> <li><strong>@GeneratedValue</strong> <ul><li>PK 생성 규칙</li> <li>스프링 부트 2.0에서는 GenerationType.IDENTITY 옵션을 추가해야만 auto_increment가 된다.</li></ul></li> <li><strong>@Id</strong> <ul><li>해당 테이블의 PK 필드를 나타낸다.</li></ul></li> <li><strong>@Column</strong> <ul><li>테이블의 컬럼을 나타내며 굳이 선언하지 않더라고 해당 클래스의 필드는 모두 컬럼이 된다.</li> <li>사용하는 이유는, 기본값 외에 추가로 변경이 필요한 옵셥이 있으면 사용한다.</li></ul></li> <li><strong>@Builder</strong> <ul><li>해당 클래스의 빌더 패턴 클래스를 생성</li> <li>생성자 상단에 선언 시 생성자에 포함된 필드만 빌더에 포함</li></ul></li></ol> <p>이 Posts 클래스에는 한 가지 특이점이 있습니다. <strong>setter 메소드가 없다</strong>는 점입니다.
자바빈 규약을 생각하면서 <strong>getter/setter를 무작정 생성</strong>하는 경우 클래스의 인스턴스 값들이 언제 변경되는지 명확하게 알 수 없다.</p> <ul><li><strong>Entity 클래스에서는 절대 Setter 메소드를 만들지 않는다.</strong></li></ul> <blockquote><p>잘못된 사용 예</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> status<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> status<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> 주문서비스의 취소이벤트<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>올바른 사용</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Order</span><span class="token punctuation">{</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cancelOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">void</span> 주문서비스의 취소이벤트<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   order<span class="token punctuation">.</span><span class="token function">cancelOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>Post 클래스 생성이 끝났다면, Post 클래스로 Database를 접근하게 해 줄 JpaRepository를 생성한다.</p> <p><img src="data:image/png;base64,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" alt="JPA"></p> <blockquote><p>PostsRepository</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>repository</span><span class="token punctuation">.</span><span class="token class-name">JpaRepository</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">PostsRepository</span> <span class="token keyword">extends</span> <span class="token class-name">JpaRepository</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Posts</span><span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>보통 ibatis나 MyBatis 등에서 Dao라고 불리는 DB Layer 접근자입니다.
JPA에선 Repository라고 부르며 <strong>인터페이스</strong>로 생성합니다. 인터페이스 생성 후 JpaRepository&lt;Entity 클래스, PK 타입&gt;을 상속하면 기본적인 CRUD 메소드가 자동으로 생성된다.</p> <ul><li><strong>@Repository</strong>를 추가할 필요 없다.</li> <li>Entity 클래스와 기본 Entity Repository는 함께 위치해야 한다.</li></ul> <h2 id="_4-spring-data-jpa-테스트-코드-작성하기"><a href="#_4-spring-data-jpa-테스트-코드-작성하기" aria-hidden="true" class="header-anchor">#</a> 4. Spring Data JPA 테스트 코드 작성하기</h2> <ul><li>PostsRepositoryTest 클래스 생성</li></ul> <p><img src="data:image/png;base64,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" alt="JPA TEST"></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domai<span class="token punctuation">.</span>posts</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">Posts</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">PostsRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsRepositoryTest</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">PostsRepository</span> postsRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@After</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        postsRepository<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> 게시글저장_블러오기<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//given</span>
        <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;테스트 게시글&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;테스트 본문&quot;</span><span class="token punctuation">;</span>

        postsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Posts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;b088081@gmail.com&quot;</span><span class="token punctuation">)</span>
                                    <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//when</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Posts</span><span class="token punctuation">&gt;</span></span> postsList <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//then</span>
        <span class="token class-name">Posts</span> posts <span class="token operator">=</span> postsList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>posts<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">assertThat</span><span class="token punctuation">(</span>posts<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="코드설명-3"><a href="#코드설명-3" aria-hidden="true" class="header-anchor">#</a> 코드설명</h4> <ol><li><strong>@After</strong> <ul><li>Junit에서 단위 테스트가 끝날 때마다 수행되는 메소드</li> <li>보통은 배포 전 전체 테스트를 수행할 때 테스트간 데이터 침범을 막기 위해 사용한다.</li> <li>여러 테스트가 동시에 수행되면 테스트용 데이터베이스인 H2에 데이터가 그대로 남아 있어 다음 테스트 실행 시 테스트가 실패할 수 있다.</li></ul></li> <li><strong>postsRepository.save</strong> <ul><li>테이블 posts에 insert/update 쿼리를 실행한다.</li> <li>id 값이 있다면 update, 없다면 insert 쿼리가 실행된다.</li></ul></li> <li><strong>postsRepository.findAll</strong> <ul><li>테이블 posts에 있는 모든 데이터를 조회해오는 메소드</li></ul></li> <li><strong>@SpringBootTest</strong> <ul><li>별다른 설정 없으면 <strong>H2 데이터베이스</strong>를 자동으로 실행해준다.</li></ul></li></ol> <h3 id="쿼리-로그-추가"><a href="#쿼리-로그-추가" aria-hidden="true" class="header-anchor">#</a> 쿼리 로그 추가</h3> <p><img src="data:image/png;base64,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" alt="properties"></p> <blockquote><p>application.properties</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jpa.show-sql=true
</code></pre></div></blockquote> <blockquote><p>쿼리 로그 확인
<img src="/about-me/assets/img/jpa4.109f8c2d.png" alt="sql log"></p></blockquote> <ul><li>create table 쿼리를 보면 <strong>id bigint generated by default as identity</strong>라는 옵션으로 생성된다.</li> <li>이는 H2 쿼리 문법으로 적용되었기 때문이다.</li> <li>출력되는 쿼리 로그를 MySql 버전으로 변경해보자</li></ul> <blockquote><p>application.properties</p> <div class="language- extra-class"><pre class="language-text"><code>spring.jpa.show-sql=true
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect
</code></pre></div></blockquote> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABN4AAABdCAYAAAB6mqtDAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABtdSURBVHhe7d1dbgRLbq1Rj8YD8JPn3+89iR6IjQBMm6A3fyIys5QlfQ8LyuAmGanS8bnoQuP2v/37f/znfwEAAAAAAAC4F1+8AQAAAAAAAA/gizcAAAAAAADgAXzxBgAAAAAAADyAL94AAAAAAACAB/DFGwAAAAAAAPAAvngDAAAAAAAAHsAXbwAAAAAAAMAD+OINwI/7xz//9b9Ujnfi7wYAAAAAtdEXb/4/XMX/gPVEVqnmqqyj+uM+E/uU6cx0n7lzl5nM7exevd4ki3XjZ0+pPVXN7o5ib6x1/K44W2XeE9kbvOH91jtEqu9bPfn7vP2zmryf6vlt/wxMxN/59DN4w2e33sHLelS9czqH76T+3lY7zezZi30nmbczV2Un1I6dvXe8w6l49+m7/OTv8EaTz0P1/MXPMf7Op5/BGz67K7/L6vWyPNb82bP+KPb481O6d8jyrO5l9c7pHGbaL97UH8BqT2SVJ3Yuq2+nV9W96bvs3LtU/bu7zGRuZ7fqs9pudpfqXlXr3sXnXa/ZvS+rqfqV7C3e9H53v8tbfrcn3+M3/POlet72e33ifeIdp3fe/a4n+ya/yzf/fvic6p+dN2Wx5uvVXJWdurrz6v1XxLtP3+Xu3+EnP5M7TN5f9bzt9/7E+8Q7Tu+8+11P9p3+LqrP1ybPUZWZSc8d4j3d72C1aq6qTZzOZe7e9+344u1/nN6vTN9l1aa95tPZsvKux6g+q+1md8nujfXJu2S7Yi2q5qY7V03Vr2Rv8ab3u/td3vK7Pfkev/Wfr7f9Xp94n7vuuPtdT/apmd/0++Hc7udd/bP0pizWfL2aq7Ls3JnsfKu73vPu37fb9/bP9/T93vZ7feJ97rrj7nc92bdmbM4/d1Sf37OTmSozk5477P4Ok+yqu/aYu/d9u6P/P95O//Cnc+b0vonT+5XJe9p50uv9VFb1eKqv2rG7/0R2b6xP3iXbFWsT1X2xNundzd7kTe+Xvcuqe5Msq3esN/70sp1+xudVrz17qk9lPt/V7aty3xPzyPo91ZPVqhkvZr7H1z2rqzyrx2ySV/xMnM122UyVZ/VqVmW+5usd1Rtr2T67q8qzejWrMl/zdTxn93NW/VZ7UxbPvl7NVVl27nQ717Pn+yxXtWrG99hzzDPVXLbHZqo8q1ezKvM1X/eyeifbabUq9z0xj6zfUz1ZrZrxYuZ7fN2zusqzeswmecXPxNlsl81UeVavZlXma77e8f1xVu3xvTEzd85F2W5vmsWeWPNnXzvNsrOvmyzP6tWsynzN1/+y7S/e4gfqs6wW6ztz3mRunY2vd7r+nX2qN9bsvLN3qfp3d5nJzulu1Vft8FkUe0+pXVbzmapF1a6J1Wt8zfeomp2r3t3sTd70ftXnqGpdv8o7cXfcUe1f51izenbu+tez6jFVlon7Y5btjHNZn6d6Yi3r8fXsWdXirK9n5ypT56qe9Ua+bz3HucnuSc+kVu1Vs53uPnVWtUnPpFbtVbN4j+pv+6Ysnn29mquyU1fvO+nx5/WsdijdnNpz0jOpVXvV7FXd3dmdcS7r81RPrGU9vp49q1qc9fXsXGXqXNWz3sj3rec4N9k96ZnUqr1qtrNmbM4/29meVU3lWd1q2cyyskj1dDV/rrJ4ruZ87TTLzqo26ZnUqr1q9i/b+uKt+mB3alXP+qn4Hk/VjJ9TVG+myz3V62vZ80TVv7vLZHOn77l6vUkW+7LaiWq3eof1M4o9nqpN2Fy3M3u+kmVWn3Ilm9jpfZp6l6rWvfvJ7xZ3+x1qX5fHeuw53Wm6PDq9r5vLTOamu63W9atc1bO+Zdqr6tVeM5m7a09X6+7pcmXyDpO9kz1drbuny/Gz1t9HuZrZfnM1mz7HWpWd2r0vmryTP0/6ld17MtP7q1p3T5fv6t4vu6+by0zmprut1vWrXNWzvmXaq+rVXjOZu2tPV+vu6XIl7o47/FntX7VqJtZUZqq57Kxq/ryT+VqXRbHHizXVE032dLXuni7/a8ZfvO3+IbLzTi3anZvsNF3v1V2+lj1PVP27u0w2d/Keqs9qVaZM7+x099pz/Kl0u3ZU9/la9nwle5s3vZ96l1VTYu5nfKbqFZuJP+Ozqqnc17N5xee+P+rySPVP7uvmMpO56W6rrZ9K7ItiXZ29mPmzryuq11M9sZbtsTuMylVNyfq9LlfUTKxle1fdU7mqKVm/1+X4WervU/1tfyqbPsdalZ3qdq7n6o5uPp4n/cruPbHuqVzVlKzf6/Jdap+vZfd1c5nJ3HS31dZPJfZFsa7OXsz82dcV1eupnljL9tgdRuWqpmT9XpcrcXfc4c/V/q7PatUOJfZXu9V5J/O1J7Ls7OueylVNyfq9Lv9rRl+8ZR+aqvva6Vxmd26y09y1Z6neM2ZVr/KpLNaqea/aNbnHm97Z6e615/hT6XbtqO7LMn8+zd7oTe+n3mX6fqsv9p78bjYTf8ZnVVO51Y3KYs27mkfdO2T7urnMZG6622oq87I81v25ytS5q3fU3OTOk56sZqps6XJl8g539WQ1U2VLl+Neu5939fd+c+bPO3Oqpnoqk51W2+nNztMd0e49WW3Sk9VMlS1X86h7v2xfN5eZzE13W01lXpbHuj9XmTp39Y6am9x50pPVTJUtXa7YTPyZ5ZWqd2ePF/ur3eq8k/naE1l2VrVJT1YzVbZ0+V/TfvG2+2Fb7XSusnvfZKepenf2LNW7rJ+K6lU+la2aEvsi1WO10+yqye51tlp172SXUs11mXIle6M3vZt6l9338/2nv5vNxXm1b3Jf1ZPNmKt5pPp9rdoX+6peo3pibdLjayrzsjzW/bnK1Lmrd9Tc5M6TnqxmqmzpcmXyDnf1ZDVTZUuX4167n3f1935bpvgeb5Jl585kpze5r+vx5/WsdkSqp9qb1SY9Wc1U2XI1j7r3q/bFvqrXqJ5Ym/T4msq8LI91f64yde7qHTU3ufOkJ6uZKlu6XIkz2TtN+2IWa2rOqCzWdnt2Ml97IsvOqjbpyWqmypYu/2v44u1/VL07e5add7ljt9ndZSZzqme3dppdNdm9zlbr7vV512tUX3Vftre67zR7gze9n3qXqtb1q3zidH92X9WnZrrc63Kl2j+5z3oms5Na1uPr2bOqqVzVs5n1XPV29ZPZ9TyZ62asvluLeZVF3W51ntTW88mcqsW8yvAu1d/2TVlVv2vn1NX7rvRYXeWK7/PzKlc1NWP13VrMq+wO07uVlVvPZHZSy3p8PXtWNZWrejaznqvern4yu54nc92M1XdrMa+yqNutzqe1+GxnNWdUFmu7Pd181jvti7VqblpbzydzqhbzKvvrRl+8KVl+da5TzVVZp+rf3bX497hz9527zGRO9WRzq+7dkV2hdlW1yd2rZ9Ln2YyarTLviewN3vR+2busujfNfB7rFevP5rKdVX9Vs30m61O6PKPusnqsZfVYm+7bmVs/s9yLmT9ndXW2mn9WuapXeawZPxP7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3+7x/8bb+pnlXsx8j697Vld5Vo/ZNI+1iWynnbPMy7KsHrNJrnQzWWZnlZmq7qmeyPqqmSyzesyz+jTPdL1V7u+a3Ol7s/5qj5+LfWrO+s00q0zmVOZnYlap5tSeSY+pssyaMbHuz77mZ1Sf71FZRc3Yrmpnlts5y7xYt2erx9z3VfUuuyLbqe6wmp+JfTGLue9R9SpXYp86Z/usVuUx87WYZTM+8z0qm/B7Ymam+3bunVj7TJap2m5W5Vm9yybUTLfH8qxv9z1Wv1f1qJrKKtWc2jPpMVW2a+3ysh5VO5mzejcbxT51zvZZrcpj5msxy2Z85ntUFmX1RWVWq7Kullm9XtWjaiqrVHNqz6THVNku27V+qr3TPNb8XJZnme+JdU/Vom5uPXuqp6opXV+Vr8xy1dfNqnrG7jJd3fNZ7FEz1m9288ruviqLPbHmz75WZd/u0S/efD17VrU46+vZucrUuapnvTuq+9fz9F6rxaw7V/WsN5ru9Of1HM/2fEctWj2+L85kWeyLNZVn9aw36vomd67nyX2xT81ke+Jc7Jvsmsx0dnY+fZ/at3NnlSnVbrWry820T+nu3T2v55hbPatlP+NzrMWsO19V7Vd3dXlWz+Zi7zqr+YraMcnsHGs+U2fVn2XqrOYtU/XI99k+b5J5Wf1E3OXPk+fJuapb7XTnRHVvperZfZ/YX5273omd/apW3VllJ7p9WX4yN61Fscefq8zOseYzdVb9WabOat6yrB75zPf6WpV1tUzsrc5d78TOflWr7qyyXWuX36feo7pPZVaLP+Nzdo41q09qkdqfZb5WZZ2uL8t9fT2rvmp3lUXV7phV5/Xc9ata3OEzX1s/FdVb1fy5m896Y5+vVdm3G33xpsQef+5qXb/KVT3rW6a9ql7tnejm73iXWL9jZ3TSN7lv0pPVompuN/OyvJurnNw5rUWTudP7TnrUTKfaofZ1eefKfersVdnEzrtkd3Vzncm8P3e7s7y6J/sZn2MtZt35bn6/uqvLs7rVTndW4ky1Y9q7syOrqfru3miyz2pV1tVOVHuqe2PWnav61Z0T2b1K7PFnr8qUarfa1eWdK/eps1dlJ7p9WX4yN61Fsaeamfbu7Mhqqr67N6tb7TTrapnY68/d7p17zJX71Nmrsl3du3R3VfPxpxKzaW/V51UzakfWr3ozXW93727NdPd61e6Y+XM1l51VbXdn5ep9VeZrXRbF3m/10f9xBautn0rsi2Jdnb2Y+bOvK6p3qpvPcn+/l+Vx1p99XVG9UdWX7VMzsZb1KLEvUj1WqzJ7Vj2WqfpSzVW6GZVPa9Fk7vS+kx4106l2qH1d3rlynzp7VZZZM56v+75YU3lWz3qVybw/d7uzfNUVy9TP6Zzvrc53sPuNr/u+WFN5Vrfa6c5KnFFnL2b+3NUXlfnaevayvqjKli43u3dM93ZO741Zd/Z1xbLYW513qNnJvqpn931ivz+rXV3euXKfOntVdqLbl+Unc6umxL4o9qizFzN/7uqLynxtPXtZX1RlkfWqmUnW1TKx15+73Tv3mCv3qbNXZbu6d+nuqubjT597MfNnz2dVn2d9qn/VFJ+r507Xq/IrNdPd661exbLYq56z2m7Pela6zM/7s6r5807ma6fZt/uxL95i5mV5rPtzlalzV/cmPV7Xf/IuMevOXX1iutOf1UzVX9Umql3Te1Yt1lVfpOYqXa/Kp7VoMnd630mPmulUO9S+Lu9cuU+dvSpTqt1qV5dn9axXmcz7c7c7y6s5y+LP+BzFrDtfVe1Xd3V5Vrfa6c5Otn/33NUXlVmt27+711RZtLtnZ3fl9N6YdeeuvpzunFCz3T7Ls77d94n9/qx2dXnnyn3q7FXZiW5flp/MXXl3m407ds9dfVGZ1br9u3sz2X3TrKtlYq8/d7t37jFX7lNnr8p2de/S3VXNx5/xeXL21L7O6jUqizXP8q4vmu69q2a6e72dPf6s5qr+rNbt3HH1virztdPs2/HFW1L3Jj1e13/yLjHrzl19YrrTn9VM1V/VJqpdu/f4rOqLpr1dn8qntWgyl+3x9fU8met61Eyn2qH2dXnnyn3q7FWZUu1Wu7o8q2e9ymTen7vdWV7NWRZ/xucoZt35qmq/uqvLs7rVTnd2sv27566+qMxq3f7dvVV9UZnVqqyrnaj2VPfGrDt39eV054Sa7fZZnvXtvk/s92e1q8s7V+5TZ6/KTnT7svxk7sq722zcsXvu6ovKrNbt392b1a12mnW1TOz15273zj3myn3q7FXZru5duruq+fgzPk/O0cq7Hs/37t617N63dP0qv1Iz3b3ezp7qvJ67flWLO3y26+p9VeZrp9m3e+3/uILPsno2s56r3q6e9e6o7j95lzgfe9VsVs96o8nO9dyd7fmOWrR6fF+cybLYF2sqz+pZr1L1Tu5cz5P7Yp+aqfb4+dg32TWZ6ezsfPo+lVX9UZUpvj/eFXd1uTftU1R/rO2c1b6sbrXsZ3yOtZh156jLI9+/nuPZnid5Vc/mYm+2c2Jy7859Wa+aUdl6jr1q1lN5NVP1T3bt7u5U+yfPk3NVt9rpzonqXmVy9+77dDv9ueud2N1f9UenWaabyfKTuWkt082v59hT7c961YzK1nPsVbOeyqvaaZadO928P1+9a9ndX/VHp5kS747z3T6VWy3+VM/+HHOly6Nqv9pV9e+o5rLM19dz7DvZmVH9Vpvcu2q7/dl50l+5et+0d9pX1b7R4/+Nt/Uzy72Y+XNWV2er+WeVq3qWn8p2Vnf4GTVntS5X9SyvZDO+Hp9jLarqnuqJrK+ayTKrd3lWz/JK1d9llk/u9L1Zv6pPald6VD1zdWeVKbFXnf3Ort+rsky8y++ws88t87mvTbKKmom1rMfEuj97fsb32XP86XPP12OfP1tN1S1T9YrfF3fb2eeW+TzW/FnV1JzVY20qm/V3+Wc727Ni/d1MzO3sn2OfonLbEWV5Neszy2PNVFmluy/Wu7PVqnrMY288W03VO9WuSPXHc1arTHdme6tMib3q7Hd2/d5pVllz2Wx33+6czVSzmW5nfLazPSvW383E3M7+OfYpWW57zB2Z5bFWif3ZzmxvlSmxV539zq7fO80Uf7+a7fZVM/Gnz33m89gbdXmk+uN9nu+zPNYmqrkuszz2ne7M2F3G12NflqnaSc86ez7rqP5Y8+cq8zXV51VZzL9Z+8Ub8Gbf+H+Mb39n/y+6b/x8sS/+zY3q/Wv4HH6HT/0dq3v4Zwk/jX8Gv8cb/p31l518Lt/yWa73/OS73nHfne9b7frk57LYZ2NUD34PvngDAAAAAAAAHsAXbwAAAAAAAMAD+OINAAAAAAAAeABfvAEAAAAAAAAP4Is3AAAAAAAA4AF88QYAAAAAAAA8gC/eAAAAAAAAgAfwxRsAAAAAAADwAL54AwAAAAAAAB7AF28AAAAAAADA7f7zv/4bWqaeqpNP5tIAAAAASUVORK5CYII=" alt="sql log"></p> <h2 id="_5-등록-수정-조회-api-만들기"><a href="#_5-등록-수정-조회-api-만들기" aria-hidden="true" class="header-anchor">#</a> 5. 등록/수정/조회 api 만들기</h2> <p>API를 만들기 위해 총 3개의 클래스가 필요합니다.</p> <ol><li>Request 데이터를 받을 Dto</li> <li>API 요청을 받을 Controller</li> <li>트랜잭션, 도메인 기능 간의 순서를 보장하는 Service</li></ol> <p>Service는<code>트랜잭션, 도메인 간 순서 보장</code>의 역할만 합니다.</p> <blockquote><p>Spring 웹 계층
<img src="/about-me/assets/img/jpa6.b42b368a.png" alt="spring web"></p></blockquote> <ul><li>Web Layer
<ul><li>흔히 사용하는 컨트롤러(@Controller)와 JSP/freemarker 등 뷰 템플릿 영역입니다.</li> <li>이외에도 필터(@Filter), 인터셉터, 컨트롤러 어드바이스(@ControllerAdvice)등 <strong>외부 요청과 응답</strong>에 대한 전반적인 영역을 이야기 합니다.</li></ul></li> <li>Service Layer
<ul><li>@Service에 사용되는 서비스 영역입니다.</li> <li>일반적으로 Controller와 Dao의 중간 영역에서 사용됩니다.</li> <li>@Transactional이 사용되어야 하는 영역이기도 합니다.</li></ul></li> <li>Repository Layer
<ul><li><strong>Database</strong>와 같이 데이터 저장소에 접근하는 영역</li> <li>Dao(Data Access Object) 영역</li></ul></li> <li>Dtos
<ul><li>Dto(Data Transfer Object)는 <strong>계층 간에 데이터 교환을 위한 객체</strong></li></ul></li> <li>Domain Model
<ul><li>도메인이라 불리는 개발 대상을 모든 사람이 동일한 관점에서 이해할 수 있고 공유할 수 있도록 단순화시킨 것을 도메인 모델이라고 한다.</li> <li>이를테면 택시 앱이라고 하면 배차, 탑승, 요금 등이 모두 도메인이 될 수 있습니다.</li> <li>@Entity가 사용된 영역이 도메인 모델이다.</li></ul></li></ul> <p><code>Web,Service,Repository,Dto,Domain</code> 이 5가지 레이어에서 비지니스 처리를 담당해야 할 곳은 어디일까요? 바로 <strong>Domain</strong>이다.</p> <p>기존에 서비스로 처리하던 방식을 <strong>트랜잭션 스크립트</strong>라고 합니다. 주문 취소 로직을 작성한다면 다음과 같습니다.</p> <blockquote><p>슈도코드</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">cancelOrder</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token number">1</span><span class="token punctuation">)</span> 데이터베이스로부터 주문정보 <span class="token punctuation">(</span><span class="token class-name">Orders</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 결제정보<span class="token punctuation">(</span><span class="token class-name">Billing</span><span class="token punctuation">)</span>
    <span class="token punctuation">,</span> 배송정보<span class="token punctuation">(</span><span class="token class-name">Delivery</span><span class="token punctuation">)</span> 조회   
  <span class="token number">2</span><span class="token punctuation">)</span> 배송 취소를 해야 하는지 확인
  <span class="token number">3</span><span class="token punctuation">)</span> <span class="token keyword">if</span><span class="token punctuation">(</span>배송 중이라면<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      배송 취소로 변경
     <span class="token punctuation">}</span>
  <span class="token number">4</span><span class="token punctuation">)</span> 각 테이블에 취소 상태 <span class="token class-name">Update</span>
<span class="token punctuation">}</span>
</code></pre></div><p>실제 코드</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">cancelOrder</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//1)</span>
   <span class="token class-name">OrderDto</span> order <span class="token operator">=</span> ordersDao<span class="token punctuation">.</span><span class="token function">selectOrders</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">BillingDto</span> billing <span class="token operator">=</span> billingDao<span class="token punctuation">.</span><span class="token function">selectBilling</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">DeliverDto</span> delivery <span class="token operator">=</span> deliveryDao<span class="token punctuation">.</span><span class="token function">selectDelivery</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//2)</span>
   <span class="token class-name">String</span> deliveryStatus <span class="token operator">=</span> delivery<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   
   <span class="token comment">//3)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">&quot;IN_PROGRESS&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>deliveryStatus<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      delivery<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;CANCEL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      deliveryDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>delivery<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token comment">//4)</span>
   order<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;CANCEL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   ordersDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>order<span class="token punctuation">)</span><span class="token punctuation">;</span>
     
   <span class="token comment">//5)</span>
   billing<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;CANCEL&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   billingDao<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>billing<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> order<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>모든 로직이 <code>서비스 클래스 내부에서 처리됩니다.</code> 그러다 보니 <code>서비스 계층이 무의미하며, 객체란 단순히 데이터 덩어리</code> 역할만 하게 됩니다.</p></blockquote> <p>반면 <strong>도메인 모델에서 처리</strong>할 경우 다음과 같은 코드가 될 수 있습니다.</p> <blockquote><div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Transactional</span>
<span class="token keyword">public</span> <span class="token class-name">Order</span> <span class="token function">cancelOrder</span><span class="token punctuation">(</span><span class="token keyword">int</span> orderId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//1)</span>
   <span class="token class-name">Order</span> order <span class="token operator">=</span> ordersRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Billing</span> billing <span class="token operator">=</span> billingRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">Deliver</span> delivery <span class="token operator">=</span> deliveryRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>orderId<span class="token punctuation">)</span><span class="token punctuation">;</span>    

   <span class="token comment">//2-3)</span>
   delivery<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//4)</span>
   order<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   billing<span class="token punctuation">.</span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">return</span> order<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>order, billing, delivery가 각자 본인의 취소 이벤트 처리를 하면, <code>서비스 메소드는 트랜잭션과 도메인 간의 순서만 보장</code>해 줍니다.</p></blockquote> <p>이러한 방식으로 등록, 수정, 삭제 기능을 만들어 보겠습니다.</p> <ul><li>Controller,Service,Dto 생성</li></ul> <p><img src="data:image/png;base64,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" alt="posts Api"></p> <h3 id="등록"><a href="#등록" aria-hidden="true" class="header-anchor">#</a> 등록</h3> <blockquote><p><strong>PostsApiController</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>service<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">PostService</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dto</span><span class="token punctuation">.</span><span class="token class-name">PostsSaveRequestDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">RequiredArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">PostMapping</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RequestBody</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">RestController</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsApiController</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PostService</span> postService<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/posts&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">PostsSaveRequestDto</span> requestDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token keyword">return</span> postService<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>requestDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostService</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>service<span class="token punctuation">.</span>posts</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">PostsRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dto</span><span class="token punctuation">.</span><span class="token class-name">PostsSaveRequestDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">RequiredArgsConstructor</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>stereotype</span><span class="token punctuation">.</span><span class="token class-name">Service</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Transactional</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostService</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">PostsRepository</span> postsRepository<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Transactional</span>
   <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">PostsSaveRequestDto</span> requestDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> postsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>requestDto<span class="token punctuation">.</span><span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>스프링을 써보셨던 분들은 Controller 와 Service에서 @Autowired가 없는 것이 어색하게 느껴집니다. 스프링에선 Bean을 주입받는 방식들이 다음과 같습니다.</p> <ul><li>@Autowired</li> <li>setter</li> <li>생성자</li></ul> <p>이 중 가장 권장하는 방식이 <strong>생성자로 주입</strong>받는 방식입니다. 즉 <strong>생성자로 Bean 객체</strong>를 받도록 하면 @Autowired와 동일한 효과를 볼 수 있다.</p> <ul><li><strong>@RequiredArgsConstructor</strong>를 통해 <strong>final이 선언된 모든 필드</strong>를 생성한다.</li></ul> <blockquote><p><strong>PostsSaveRequestDto</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">Posts</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Getter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsSaveRequestDto</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>
   <span class="token annotation punctuation">@Builder</span>
   <span class="token keyword">public</span> <span class="token class-name">PostsSaveRequestDto</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">,</span>
                                         <span class="token class-name">String</span> author<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> author<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">Posts</span> <span class="token function">toEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">return</span> <span class="token class-name">Posts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span>author<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>여기서 Entity 클래스와 거의 유사한 형태임에도 Dto클래스를 추가로 생성했습니다. 하지만, 절대로 <strong>Entity 클래스를 Request/Response 클래스로 사용해서는 안된다.</strong>
Entity 클래스는 <strong>데이터베이스와 맞닿은 핵심 클래스</strong>입니다.</p> <ul><li>View Layer 와 DB Layer의 역할 분리를 철저하게 하는게 좋습니다.</li></ul> <blockquote><p><strong>PostsApiControllerTest</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">Posts</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">PostsRepository</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dto</span><span class="token punctuation">.</span><span class="token class-name">PostsSaveRequestDto</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">After</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit</span><span class="token punctuation">.</span><span class="token class-name">Test</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>junit<span class="token punctuation">.</span>runner</span><span class="token punctuation">.</span><span class="token class-name">RunWith</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>beans<span class="token punctuation">.</span>factory<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">Autowired</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context</span><span class="token punctuation">.</span><span class="token class-name">SpringBootTest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>test<span class="token punctuation">.</span>web<span class="token punctuation">.</span>client</span><span class="token punctuation">.</span><span class="token class-name">TestRestTemplate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>server</span><span class="token punctuation">.</span><span class="token class-name">LocalServerPort</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">HttpStatus</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http</span><span class="token punctuation">.</span><span class="token class-name">ResponseEntity</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>test<span class="token punctuation">.</span>context<span class="token punctuation">.</span>junit4</span><span class="token punctuation">.</span><span class="token class-name">SpringRunner</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>util</span><span class="token punctuation">.</span><span class="token class-name">List</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token namespace">org<span class="token punctuation">.</span>assertj<span class="token punctuation">.</span>core<span class="token punctuation">.</span>api</span><span class="token punctuation">.</span><span class="token class-name">Assertions</span><span class="token punctuation">.</span>assertThat<span class="token punctuation">;</span>

<span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsApiControllerTest</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@LocalServerPort</span>
   <span class="token keyword">private</span> <span class="token keyword">int</span> port<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> <span class="token class-name">TestRestTemplate</span> restTemplate<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Autowired</span>
   <span class="token keyword">private</span> <span class="token class-name">PostsRepository</span> postsRepository<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@After</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">tearDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       postsRepository<span class="token punctuation">.</span><span class="token function">deleteAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Posts_</span>등록된다<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token comment">//given</span>
       <span class="token class-name">String</span> title <span class="token operator">=</span> <span class="token string">&quot;title&quot;</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> content <span class="token operator">=</span> <span class="token string">&quot;content&quot;</span><span class="token punctuation">;</span>
       <span class="token class-name">PostsSaveRequestDto</span> requestDto <span class="token operator">=</span> <span class="token class-name">PostsSaveRequestDto</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:&quot;</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">&quot;/api/v1/posts&quot;</span><span class="token punctuation">;</span>

       <span class="token comment">//when</span>
       <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> requestDto<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//then</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isGreaterThan</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Posts</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>all<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>all<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <ul><li>@WebMvcTest의 경우 JPA 기능이 작동하지 않기 때문에 사용하지 않았다.</li> <li>@SpringBootTest와 TestRestTemplate 사용</li> <li>SpringBootTest.WebEnvironment.RANDOM_PORT 랜덤 포트 사용</li></ul> <h3 id="수정-조회"><a href="#수정-조회" aria-hidden="true" class="header-anchor">#</a> 수정/조회</h3> <blockquote><p><strong>PostsApiController</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsApiController</span> <span class="token punctuation">{</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

   <span class="token annotation punctuation">@PutMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/posts/{id}&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token annotation punctuation">@RequestBody</span> 
<span class="token class-name">PostsUpdateRequestDto</span> requestDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token keyword">return</span> postService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> requestDto<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/api/v1/posts/{id}&quot;</span><span class="token punctuation">)</span>
   <span class="token keyword">public</span> <span class="token class-name">PostsResponseDto</span> findById <span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>

       <span class="token keyword">return</span> postService<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostsResponseDto</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>posts</span><span class="token punctuation">.</span><span class="token class-name">Posts</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Getter</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsResponseDto</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">Long</span> id<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> author<span class="token punctuation">;</span>

   <span class="token keyword">public</span> <span class="token class-name">PostsResponseDto</span><span class="token punctuation">(</span><span class="token class-name">Posts</span> entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>author <span class="token operator">=</span> entity<span class="token punctuation">.</span><span class="token function">getAuthor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostsResponseDto</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dto</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Builder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Getter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">NoArgsConstructor</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsUpdateRequestDto</span> <span class="token punctuation">{</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
   <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Builder</span>
   <span class="token keyword">public</span> <span class="token class-name">PostsUpdateRequestDto</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>Post</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@NoArgsConstructor</span>
<span class="token annotation punctuation">@Entity</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Posts</span> <span class="token punctuation">{</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><strong>PostService</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostService</span> <span class="token punctuation">{</span>
	
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

   <span class="token annotation punctuation">@Transactional</span>
   <span class="token keyword">public</span> <span class="token class-name">Long</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">,</span> <span class="token class-name">PostsUpdateRequestDto</span> requestDto<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Posts</span> posts <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;해당 게시글이 없습니다. id=&quot;</span><span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       posts<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>requestDto<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> requestDto<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> id<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token keyword">public</span> <span class="token class-name">PostsResponseDto</span> findById <span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token class-name">Posts</span> entity <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token string">&quot;해당 게시글이 없습니다. id=&quot;</span><span class="token operator">+</span> id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PostsResponseDto</span><span class="token punctuation">(</span>entity<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>여기서 신기한 것이 있습니다. update 기능에서 데이터베이스에 <strong>쿼리를 날리는 부분이 없습니다.</strong> 이게 가능한 이유가 JPA의 <strong>영속성 컨텍스트</strong> 때문입니다.</p> <p>영속성 컨텍스트란, <strong>엔티티를 영구 저장하는 환경</strong>입니다. 일종의 놀리적 개념이라고 보시면 되며, JPA의 핵심 내용은 <strong>엔티티가 영속성 컨텍스트에 포함되어 있냐 아니냐</strong>로 갈립니다.</p> <p>JPA의 엔티티 매니저(EntityManager)가 활성화된 상태로(Spring Data Jpa를 쓴다면 기본옵션) <strong>트랜잭션 안에서 데이터베이스에서 데이터를 가져오면</strong> 이 데이터는 영속성 컨텍스트가 유지된 상태입니다.</p> <p>이 상태에서 해당 데이터의 값을 변경하면 <strong>트랜잭션이 끝나는 시점에 해당 테이블에 변경분을 반영</strong>합니다. 즉 Entity 객체의 값만 변경하면 별도로 <strong>Update 쿼리를 날릴 필요가 없다</strong>는 것이죠, 이 개념을 <strong>더티 체킹</strong>이라고 합니다.</p> <ul><li>더티 체킹(<a href="https://jojoldu.tistory.com/415" target="_blank" rel="noopener noreferrer">Dirty Checking<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)이란?</li></ul> <blockquote><p><strong>PostsApiControllerTest</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@RunWith</span><span class="token punctuation">(</span><span class="token class-name">SpringRunner</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@SpringBootTest</span><span class="token punctuation">(</span>webEnvironment <span class="token operator">=</span> <span class="token class-name">SpringBootTest</span><span class="token punctuation">.</span><span class="token class-name">WebEnvironment</span><span class="token punctuation">.</span>RANDOM_PORT<span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PostsApiControllerTest</span> <span class="token punctuation">{</span>

	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">Posts_</span>수정된다<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
       <span class="token comment">//given</span>
       <span class="token class-name">Posts</span> savePosts <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Posts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">Long</span> updateId <span class="token operator">=</span> savePosts<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> expectedTitle <span class="token operator">=</span> <span class="token string">&quot;title2&quot;</span><span class="token punctuation">;</span>
       <span class="token class-name">String</span> expectedContent <span class="token operator">=</span> <span class="token string">&quot;content2&quot;</span><span class="token punctuation">;</span>
       <span class="token class-name">PostsUpdateRequestDto</span> requestDto <span class="token operator">=</span> <span class="token class-name">PostsUpdateRequestDto</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span>expectedTitle<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span>expectedContent<span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">String</span> url <span class="token operator">=</span> <span class="token string">&quot;http://localhost:&quot;</span> <span class="token operator">+</span> port <span class="token operator">+</span> <span class="token string">&quot;/api/v1/posts/&quot;</span> <span class="token operator">+</span> updateId<span class="token punctuation">;</span>

       <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PostsUpdateRequestDto</span><span class="token punctuation">&gt;</span></span> requestEntity <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>requestDto<span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//when</span>
       <span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> responseEntity <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">exchange</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token class-name">HttpMethod</span><span class="token punctuation">.</span>PUT<span class="token punctuation">,</span> requestEntity<span class="token punctuation">,</span> <span class="token class-name">Long</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//then</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token punctuation">.</span>OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>responseEntity<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isGreaterThan</span><span class="token punctuation">(</span><span class="token number">0L</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Posts</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>all<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>expectedTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>all<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isEqualTo</span><span class="token punctuation">(</span>expectedContent<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <p>테스트 결과를 보면 update 쿼리가 수행된는 것을 확인 할 수 있습니다.</p> <blockquote><p>Posts 수정 API 테스트 결과</p> <p><img src="/about-me/assets/img/jpa8.6e5d2907.png" alt="POST UPDATE LOG"></p></blockquote> <ul><li><strong>조회 기능은 실제로 톰갯을 실행</strong>해서 확인해 보겠습니다.</li></ul> <blockquote><p><strong>application.properties</strong> 추가</p> <div class="language- extra-class"><pre class="language-text"><code>spring.h2.console.enabled=true
</code></pre></div><p>톰캣 실행 후 http://localhost:8080/h2-console 접속
<img src="/about-me/assets/img/jpa9.11c4e29d.png" width="70%" height="70%" title="h2console" alt="h2console"><br>
SELECT * FROM posts; 쿼리 실행</p> <p><img src="/about-me/assets/img/jpa10.f44afbd0.png" width="70%" height="70%" title="h2console" alt="h2console"><br>
insert into posts(author, content, title) values ('author', 'content', 'title'); 쿼리실행</p> <p><img src="/about-me/assets/img/jpa11.dcd0748b.png" width="70%" height="70%" title="h2console" alt="h2console"><br> <strong>브라우저로 Posts API 조회</strong></p> <p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAewAAACFCAYAAACZpstGAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAABXgSURBVHhe7Z19rx3VdYf9URKJb9H8gcpHaKW2KEoaiCnGbklo01QB46CmbaKKEIpF1ZekCSVpS2kTO1hqExpVJThAROAPVAiJwaCAneBifK+N366ZzpqZfWbtPWvPnHk79+zj55F+8pn9svba+3jmd/acuffuee2Nt7MuvX36THZu+0J28dLlbOfatQwAdg85B+VclHPyrfzctM5ZhNDmqdOwz57bri4TALCOnH1v2zx3EUKbpVbDvnT5SnVJAIB15tKlK+Y5jBDaHEUN++x7W9WlAABS4N38nLXO5aE6YZQ5tdUhhOaRadhvnXqnugQAQEr8Ij93rXMaIZS+TMPe2r5Qnf4AkBLyIJp1TiOE0pdp2PIEKgCkx8WLlxvn81I6aZT11RQxEEJRmYZ97YMPqtMfAFJiZ+da43xGCG2GTMMGgHSxzumo5tgVs9NGaBZh2AAbhnVOI4TS1yyGffbcueyLf/nl7LY77sx+95P7CslrKZM6AJgP65xGCKWvyQ37P7//X9mtt+3PPn7r7dkn9u7L7rzrj7NPf+ZzhWlLmdRJm368mD144wPZS9XRdOi4c40BsFqsc3qsPnn7/mzvvgNmHUJoNZrUsMWIxZg/sfeO7Mh3j2UfVA+vvfzKq4VZO0mbfqadoGG/8ED2kftfrA4CTh3N7rrxpuwjon1HszNVcYH0M+tOZcf2VeU3HsiOnaqKBR0vMoeX7g/69KHIyYibl991pDvoS/ffFG8nucfWaQxt628Qrk9rzmuOdU6Plfs/adUhhFajyQxbbnXfsnd/YdanTp2uSrPsnx/7t+zOP/ysZ9gi2Wkvf3t8kwxbjLc2hzNHDtTtCuOtc9CmIe0WBuK1k7wj8RyzmKLMo329ilzyi/xd+Xxj5jfqg0QbfQxbrc8yOU/Nb/72zdmfffFL1VGNlEldX6xzeqwwbIR2X5MZtnw/LUYsO2vHa6+fbBi1lvRZjtBM5djtKG/KHnyhKq4QoyvrAiOr2tcX4qZhH1Pt/LgtYxY70Lpcj1XmUO6Oy3HzOHrnHJiFZxJSV7X1jU2ZZcOY9JxKJG6dr55H3a4c+6hZp/NY4PJu1PkfSITGvBaotajiHFu8d8EaS/0iNz9+/X6XOTfXPy9U/cNc/PUpiec8PV956HCRlzZteS1lUtcX65weK7eeVh1CaDWazLD33v77xXfW7ja48MpPX80+d/C+QlIfGrY8iLYc2oRK8/MNqL6AFxfrhYHlbY/I6xfzf93FV7fXceW1upiLES6MqG1MHSM3jxeqsVt32HUsbQxiPL5x1LG9eSmTbBpLaJh5DGWoZ3JTdrnqmMVrbYR6/g1T1h8ggvGMts0cS6R8Md/KUOt24RoHY7g199b5xXz9q5deuZ/jmfw9qvPz18cRy3kuvvAXpUGLUTuzlrIhWOf0WGHYCO2+JjNs+V5aHjCL8fDf/L1n1rf+3v6iz3LUxmUZYX1xVe2i6Iu3bh/2lXbLjqnMxGH0qZHY1Q5QtWkzbEHGLC+cfplvLIGB5nlEjUflaMepxmmYcJ6XOtZ9m3HsMi++EDF6WQ+r/2KtZA6G4frrX663v7YVkfWxc56X0rR/vXiPh5q1YJ3TfSQPmDmD7hIPoiG0Ok1q2NqQ5bvsz/zJwew7R58odt3nzm1ljz3+7exrX//H7LkfP1+Y+1DDblxIFxdn30g0cgGuLzT9DTs+piB9Ja7q79Urit2hb6jOcEzDLupKw6lzkPHKGE1j0UYYmGKBy7VSq2FXeQZmKm29PKW+iGONFzG/cE0jhi1tGuPleDFlDdVcChrrX66hfzvdzlcwc54Zt7P+tVz69nhfrHO6j/oYtrS1YiCEptekt8S1YWs9ffyZqlWJGLjcPh90S9wwwvriqtoppL7uo4zIax/2VRfz1jEV2nSMPkKzX51Po84ZYYuZNcfJ5+HaLozUIXNUhqX6NvNS6+GNb5lcVdYYr8Raq8bDZsYc3QcYu39zx+y1i6x/Y15mG3vMOdG3wfXt8SFY5/RYOYO26hBCq9HkD51Z+odHvlm1KpEH06R82ENn8lpfrH0Tkgt5faHOjeTIi0WZdyFftA/jaiPSxtQ2ZvD9eIdhl+OrccQ0tIGoutqUwvElN11Xz18bjWmKi/hlDG3Y4a32Rf7aTPP8LSMrxs0/eNQ51jTMzzLKIjc1R51r8VrNRde9cLQu17l561/+P1i8rt7XtifUGznPiHvoTN8Gd6bNQ2cIIafJDNv9WJc26q9949HsyR/8d/a/L79Stcovl6dOF7fLx/1YV2lg7iLim0RlREVddUGuzKAoyy/i9YVaxw3HqC/sJfExiw8JjXLXXsYqc3IGUJqj6+ObhlenTU3PIZdnJsWHgKpusUvNxw92rEKdaz5ubnbOOEuDUk+J674ydnUcNTltogGh+clxw9irMeqnxINxvPnrOv2+WO9X2Vava5mLvT6OMOc5+Y3f+h3zO2spk7q+WOf0WLm1s+oQQqvRZIYtuF+c4gz7x8//pKopb4PLzlrMWtr0/21n0AfTFFtYyqDENMOdcW8iRqk+FKyCvuuTEtY5PVYYNkK7r0kNW/iP7z25+NWkt9x2R/apP/ps8YCZfGctZcN+NSnMzSp3lCYrNuxNxjqnx0oeLuMBM4R2V5MbtiC3uuX7af74Rzpg2JuDdU4jhNLXLIYNALuHdU4jhNIXhg2wYVjndEwnjLKxmiMmQsgw7Dd+Uf/hDgBIDzmHw/MaIZS+GoZ9+lf/V532AJAip/JzODyvuzTFrpidNULzqmHY7763VZ32AJAi757d8s5phNBmyDPs1988lV29ulOd9gCQInIO6/MaIbQZ8gz77Lnt6pQHgJQ5+962d6IjhNLXwrDfOs1PwAJsEm+dfqdxwiOE0lVh2HxvDbCZ8H02QpujPZcuXa5ObQDYRC7m5/iZd89lb//yjHkRQAiloT3VOQ0AAABrDIYNAACQABg2AABAAmDYAAAACYBhbwg7OzvFw0Xn338/2zp/ITu3fR4hhNAGCcNOnMtXrmLQCCF0HQjDTpQrV69m26sy6q1tuxwhhNDKhGEniJi19WbOoi2jDCGE0MqFYSeG/GEH641ECCG02cKwE+LatWvmm4gQQmjzhWEnxPYFHi5DCKHrVZMY9oXcSA5+/guFdosfPftc9qNnnsuuXLlSlcyPzPvbR54o5v3xW28vJK+/+U+PFXWOv/3q16tXw5Gnwa03sE2nfvmr7LF/fTw7eO/ns1tu3VtIXkuZ1Fl9EEIIradGG7YzazGrew79aVW6esSwv/fkD1Zm2v/zw+PZvgOfXhh1KKmTNmLWcjyWrfP2GxjT9/O12H/gDwqT/vIDD2b/8tjjheS1lEmdtLH6xnUye+SjN2R3P23VTanj2d0f/lj2yOvl8YlHP5Z96J7jQRvUWyeeyO6940D20DNGHUJo7TXKsEOz1rvKVSMmvSrTFiN2xiyG/MYbb1Y1WfHambTWGPo+FS5GXOymDx7KXjv5ZqNeyqRO2vzweB8jvA4N+5mHs325yZW6Lztyoq3+4ey4rtt+LTtyyNXlOvysqmvW33v0taDe6dnsoUbsiSVmfuiJ7GdWnaHjhzuMv2e81cpYz7XOF6FSgw17nczasQrTlnm6nbUYd4w//9L9kxn2+xcvmW+eJbnVLbtnMWRdLuYs0mXSRtouf3t88wz7qXtuyG5+9KRZV+5IlUkX5qwu9MHxz47el+1TF30xtdqkS3OuTTk8FhOxTVDixs18GnUasJP6gNLWful4oyRrZnyI6pC/nupDE4aN1lyDDHsdzdoxt2n/+3e+W8y77XvpqXfY8utGrTfPktz2FmMOd9aWYUsbKZM+ujyu68ywxZy8XbFc3GuDaJqSNhC/bSEdz9jRFYZv7sL7m1I/LbuDr+fXbsjLxhurIYbtr+dizdlhowTU27DX2awdc5q2zFnmrm+DayyzFo2hz68elV2zfE9t1VmStvIgmlXXlGHYTx/KPvThG2p99FvZCaOPq9fmWBjxou+h7KlFH9uwxVwX7QMD92M163XfMgc/L5HMy98VB4Yghru4qNtmoY3MN+ByJ2fXVbJMwxtTJONWO8JceuftYhb/ujaNvs2c61z8HJ1kTuEOv82w/bm5Mf28w75eziJvbXTfKv/i7odqv/iAYLRdxMnVWM9KGDZKQL0N2xlWH4nBT4Uz4j4S054KN6dVYr1xMcV2zNYOW+R25GG5rcCwC7OujVVUGOPCLMv22qSferQy9Ne/ld2ty71+hmFXhlrU531vbtRrww/GlTzVB4lFDvI62GH7hi1SBtAwv+YuMjQ3bUTapKS8cZu7MCE/ZmiMxw+r+qJ9bUpuLB3Xn4/kHJpYZMfp6o2cRHHDDu8IuPXryluPUX5wcPPw1/TZ7Ih6Hc4n3rauN/PGsFECWolhS5+pGGTYeZ+pcHNaJdYbF9MqDVvMztttF1JmGxhlq6Rtm2EbO+ZybMnJ/9BQqDD1ysRb8ggN25PsxqJG02XYvum4OmeGyxm2PUatDrMtpGM0Da5pVP6YZp65ljc+Y8xcddzQ4CuptfBNWKsZO95W5M/NUyNvhNZPg26JO9OWnfPa3hLPd9XOrFd5S1wja/Pg4b8uvvcewxS3xGOGXdwSDx5Qi0sbtm/efpvSQC2j1Wrcxl6Yah/D9tvWkvJ6112P5bdtM2zLlGqjsY1o0cc0gNowTHMN+thmKTHKHXu4czdjeibVzNmaY216ETOt2liG3Sy316lrHf28yw8/xXw7PwzE2sbWsxKGjRLQ4IfO1tW05zRrYZmHzhzu++xl2rZx/sJ6PnQW32GrnW3EsBtG6e2CJ9phW7vq4HZ63LDLC39oSrUpWvXKQMzvStvrfcM1zFLtOus2dQ6mYXt9QoPTpqjkcmsxMduwrXjhmKU6PxRExi7muCi3Y9ttI+M4YdgoAQ0ybGEdTXtusxZknrcf+FQx77Yf69I/q/3OO2eq0mFcvDTgx7qCB8kswx79Y11issaOtTZXMV7fEMvvj8PdedlumGG73XP8O+wTjx5SOTZj6/zESJzp+Rf8XIX5KaMKbpn7hilm4ptaEdszEH37NjAfiR2ab2DyxXjhDtsbs30MaW/vOEtze+hwroYpl7IM245XroO3jta6eUav885fHw76emuoTbilrbWeWhg2SkCDDVtYJ9NehVk7tBn/3Ve/4d0ef/mVnxZlrr7N1Jfl6k6/v9C1+MUpuWmHO22RlLlfVzr6F6cUpl3d0hY1dtSVGVfyzd6V52Y7eIet2qhx/F1zJAdRseOuy7Vhi5wJOlkmtahvXPArs1qyXse2DNEZmWt/79Fni2PXrsglNyzdxjcpbdih2flqmqivZn6xeNWYR8WkXV7NduE6e8ZfGLyr83Oq+1Xlkbb2eiph2CgBjTJsITTt3UJMehVm7Xj+Jy8sdtqWpG4Ks3Zs97gtLtK/mvSBr/xV8fvDRfJayqSun1mjlanYycfNMqbSsFt2kVreTnUCRePpDwm7pIHridC6abRhC860RbuFGPWqzNoh85bvtN0HFjFp+Q1nUjb13YYhfwdbbnXL99Ny61tMuth156+lbPnb4GjVEuO1b1W3q49hd+44eyoeb/cNe+h6IrRumsSwYTX03WWj60u9dtgr0xrssBHaEGHYCXHt2jXzTUQIIbT5wrATo+9f7kIIIbQZwrATZMj32YO1ZZQhhBBauTDsRJHb49s9fgPaKG1t2+UIIYRWJgw7cS5fudrrV5cihBBKUxj2hrCzs5NdvHS5+NvZGDhCCG2eMGwAAIAEwLABAAASAMMGAABIAAwbAAAgAfa8+vOTGUIIIYTWW+ywAQAAEgDDBgAASAAMGwAAIAEwbAAAgATAsAEAABIAwwYAAEgADBsAACABMGwAAIAEwLABAAASYCnD3rMHXwcAgPXkevGozlnGFsKVd9W3EbbpitnGmD6rGk9YZZ5D+wlD+ghjxurbd2i/VGBdbFJYl7nGYO7x+KuY227TOcOuxRmzeGGbrpgxpH3fPkLbeF3xYvVD+7Xh+vTt29avK1asfmi/Nlyfvn2H9hvKHOO0xRw6v6H9hjLHOG0xh85vaL82YrGmHEMzdA5D+7URizXlGJquOcw17jrROcM5F6FvbGm/qjdraLyuflPnKUjMvnFTmt+6MMfcxsSUvuuw3uu2Lqskludu5S/jrmrsdZz7ptM5w6GL0PZmak3F1LG6crTKh/YTuvpNiR4rNp5VPrSf0NVvatrGi9Xp8j51QqxOl/epm4u28WJ1urxPnRCr0+V96uYiNl7bse5jtYvVCV117l+rfmrcOOFYbce6j9UuVid01bl/rfo2+rZPkegMhyyYxuoblk25wFPGErrixeqH9AvLumJMwZA8hSH9wrKuGGNpG29onRAeO+aIOQdD82yrE8Jjxxwx52COPMfGDMvmoi2XtjohluPYmGFZH8b2X3c6ZzZ08la/sGzKhZ36TeqKF6sf0i8s64oxBUPyFIb0C8u6YoylLX5bLl15xuLOEXMO2sZqy6sr51jcOWKuginybGs3NOYqmCLPtnZDYy7DmL6p0DnDoYtg9ZvyzQmZ+s3qiherH9JPykLNTdcYsfoh/aQs1Jy0xQ/r9HFbnRCLK+WhHPq10HU8J21jteXVlXMsrpSHcujXQtfx3Lj8nBxhHl3HjrZ2Q2POhYyn5Qjz6Dp2tLUbGnMZxvRNhc4ZDl0Eq9/YN0fax/r0jdVFV7yheVj1Y3OX/n1jDMlTGNKvb25jaRsvrNPHbXVCLG6sXBgacxmkb5/+bW3b8mqrE2JxY+XC0Jhz0Db20DzniLkM0rdP/7ax2+qE2DhzxFyGMX1ToXOGQxfB6jflmxPSFmvIOF19YvVD+oVlXTGmYEiewpB+YVlXjJCx7fXx0DohPHbMEXMOhubZVieEx445Yi5D375tY3flFRtrjphzMEeec8RchjF9U6FzhkMXIdZPyrWmoi3W0HHacuwar28/1ydWPwdt47XlMaSf6xOrb2Non9h4sbquY8HqJ7jysK7rWLD6zYUbqy2PsK7rWLD6Ca48rOs6Fqx+yzC0jx5Px9B1utxhlS9zbPUTrLI5CXPR4+s6Xe6wypc5tvoJVtmyjOmbCkvNMOWFuB7exE2G9w/6wP+X65Pr5X3nfzcAAEACYNgAAAAJgGEDAAAkAIYNAACQABg2AABAAmDYAAAACYBhAwAAJACGDQAAkAAYNgAAQAJg2AAAAAmAYQMAACQAhg0AAJAAGDYAAEACYNgAAAAJgGEDAAAkAIYNAACQABg2AABAAmDYAAAACYBhAwAAJACGDQAAkAAYNgAAQAJg2AAAAAmAYQMAACQAhg0AAJAAGDYAAEACYNgAAAAJgGEDAAAkAIYNAACQABg2AABAAmDYAAAACYBhAwAAJACGDQAAkAAYNgAAQAJg2AAAAAmAYQMAACQAhg0AAJAAGDYAAEACYNgAAAAJgGEDAAAkAIYNAACQABg2AADA2pNl/w8zUNES4/piUAAAAABJRU5ErkJggg==" width="70%" height="70%" title="h2console" alt="h2console"><br></p></blockquote> <h2 id="_6-jpa-auditing으로-생성시간-수정시간-자동화하기"><a href="#_6-jpa-auditing으로-생성시간-수정시간-자동화하기" aria-hidden="true" class="header-anchor">#</a> 6. JPA Auditing으로 생성시간/수정시간 자동화하기</h2> <h3 id="localdate-사용"><a href="#localdate-사용" aria-hidden="true" class="header-anchor">#</a> LocalDate 사용</h3> <p>Java8부터 LocalDate와 LocalDateTime이 등장했습니다.
그긴 Java의 기본 날짜 타입인 Date의 문제점을 제대로 고친 타입이라 Java8 이상일 경우 무조건 사용해야한다.</p> <blockquote><p>참고
Naver D2 - <a href="https://d2.naver.com/helloworld/645609" target="_blank" rel="noopener noreferrer">Java의 날짜와 시간 API<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></blockquote> <p>LocalDate와 LocalDateTime이 데이터베이스에 제대로 매핑되지 않는 이슈가 Hibernate 5.2.10 버전에서 해결되었습니다.</p> <p>스프링 부트 1.x를 쓴다면 별도로 Hibernate 5.2.10 이상을 사용하도록 설정이 필요하지만, 스프링 부트 2.x 버전을 사용하면 기본적으로 해당 버전을 사용 중이라 별다른 설정 없이 바로 적용 가능하다.</p> <p>domain 패기키지에 BaseTimeEntity 클래스 생성</p> <p><img src="data:image/png;base64,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" alt="BaseTimeEntity"></p> <blockquote><p><strong>BaseTimeEntity</strong></p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>swchoi<span class="token punctuation">.</span>webservice<span class="token punctuation">.</span>springboot<span class="token punctuation">.</span>domain</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> lombok<span class="token punctuation">.</span><span class="token class-name">Getter</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">CreatedDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>annotation</span><span class="token punctuation">.</span><span class="token class-name">LastModifiedDate</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>data<span class="token punctuation">.</span>jpa<span class="token punctuation">.</span>domain<span class="token punctuation">.</span>support</span><span class="token punctuation">.</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span><span class="token class-name">EntityListeners</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">javax<span class="token punctuation">.</span>persistence</span><span class="token punctuation">.</span><span class="token class-name">MappedSuperclass</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>time</span><span class="token punctuation">.</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@MappedSuperclass</span>
<span class="token annotation punctuation">@EntityListeners</span><span class="token punctuation">(</span><span class="token class-name">AuditingEntityListener</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BaseTimeEntity</span> <span class="token punctuation">{</span>

   <span class="token annotation punctuation">@CreatedDate</span>
   <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> createDate<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@LastModifiedDate</span>
   <span class="token keyword">private</span> <span class="token class-name">LocalDateTime</span> modifiedDate<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></blockquote> <ol><li>@MappedSuperclass
<ul><li>JPA Entity 클래스들이 BaseTimeEntity을 상속할 경우 필드들(createDate,modifiedDate)도 컬럼으로 인식하도록 합니다.</li></ul></li> <li>@EntityListeners(AuditingEntityListener.class)
<ul><li>BaseTimeEntity 클래스에 Auditing 기능을 포함시킵니다.</li></ul></li> <li>@CreatedDate
<ul><li>Entity가 생성되어 저장될 때 시간이 자동 저장됩니다.</li></ul></li> <li>@LastModifiedDate
<ul><li>조회환 Entity의 값이 변경할 때 시간이 자동 저장됩니다.</li></ul></li></ol> <ul><li>Posts 클래스가 BaseTimeEntity를 상속받도록 변경합니다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code>    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Posts</span> <span class="token keyword">extends</span> <span class="token class-name">BaseTimeEntity</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>마지막으로 JPA Auditing 어노테이션들을 모두 활성화 할수 있도록 Application 클래스에 활성화 어노테이션 추가하겠습니다.</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@EnableJpaAuditing</span> <span class="token comment">// JPA Auditing 활성화</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Application</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Application</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="jpa-auditing-테스트-코드-작성하기"><a href="#jpa-auditing-테스트-코드-작성하기" aria-hidden="true" class="header-anchor">#</a> JPA Auditing 테스트 코드 작성하기</h3> <blockquote><p><strong>PostsRepositryTest BaseTimeEntity_등록 추가</strong></p> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token annotation punctuation">@Test</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token class-name">BaseTimeEntity_</span>등록<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">//given</span>
       <span class="token class-name">LocalDateTime</span> now <span class="token operator">=</span> <span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token number">2020</span><span class="token punctuation">,</span><span class="token number">03</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       postsRepository<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token class-name">Posts</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">title</span><span class="token punctuation">(</span><span class="token string">&quot;title&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">content</span><span class="token punctuation">(</span><span class="token string">&quot;content&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">author</span><span class="token punctuation">(</span><span class="token string">&quot;author&quot;</span><span class="token punctuation">)</span>
               <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//when</span>
       <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Posts</span><span class="token punctuation">&gt;</span></span> postsList <span class="token operator">=</span> postsRepository<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token comment">//then</span>
       <span class="token class-name">Posts</span> posts <span class="token operator">=</span> postsList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

       <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt; createDate=&quot;</span><span class="token operator">+</span>posts<span class="token punctuation">.</span><span class="token function">getCreateDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
               <span class="token operator">+</span><span class="token string">&quot;, modeifeidDate=&quot;</span><span class="token operator">+</span>posts<span class="token punctuation">.</span><span class="token function">getModifiedDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


       <span class="token function">assertThat</span><span class="token punctuation">(</span>posts<span class="token punctuation">.</span><span class="token function">getCreateDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token function">assertThat</span><span class="token punctuation">(</span>posts<span class="token punctuation">.</span><span class="token function">getModifiedDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isAfter</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token punctuation">}</span>
</code></pre></div><p>테스트 결과
<img src="/about-me/assets/img/jpa14.5e81480b.png" alt="BaseTimeEntity"></p></blockquote></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/ChoiSeungWon/about-me/edit/master/docs/spring/chater03/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/19/2020, 3:41:28 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/about-me/spring/chater02/" class="prev">
          Spring Boot 테스트 코드 작성
        </a></span> <span class="next"><a href="/about-me/spring/chater04/">
          Mustache로 화면 구성하기
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/about-me/assets/js/app.1fd5ee7f.js" defer></script><script src="/about-me/assets/js/7.be9fab67.js" defer></script>
  </body>
</html>
