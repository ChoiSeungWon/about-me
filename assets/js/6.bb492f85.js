(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{288:function(a,e,t){a.exports=t.p+"assets/img/deploy1.6616b165.png"},289:function(a,e,t){a.exports=t.p+"assets/img/deploy2.fc34d3df.png"},290:function(a,e,t){a.exports=t.p+"assets/img/deploy3.318a5bd5.png"},291:function(a,e,t){a.exports=t.p+"assets/img/deploy4.9a3728f0.png"},292:function(a,e){a.exports="data:image/png;base64,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"},293:function(a,e,t){a.exports=t.p+"assets/img/deploy6.1bbad10e.png"},294:function(a,e,t){a.exports=t.p+"assets/img/deploy9.5cad6b7d.png"},295:function(a,e,t){a.exports=t.p+"assets/img/deploy10.fe741c2a.png"},296:function(a,e,t){a.exports=t.p+"assets/img/deploy11.408affe1.png"},297:function(a,e,t){a.exports=t.p+"assets/img/deploy12.99dfce8e.png"},298:function(a,e,t){a.exports=t.p+"assets/img/deploy13.b6fe7a89.png"},299:function(a,e,t){a.exports=t.p+"assets/img/deploy14.a010b786.png"},300:function(a,e,t){a.exports=t.p+"assets/img/deploy15.70455d3f.png"},301:function(a,e,t){a.exports=t.p+"assets/img/deploy16.26b7b04e.png"},302:function(a,e,t){a.exports=t.p+"assets/img/deploy17.9f8848b8.png"},378:function(a,e,t){"use strict";t.r(e);var s=[function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("div",{staticClass:"content"},[s("h1",{attrs:{id:"ec2-서버에-스프링부트-배포"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ec2-서버에-스프링부트-배포","aria-hidden":"true"}},[a._v("#")]),a._v(" EC2 서버에 스프링부트 배포")]),a._v(" "),s("h2",{attrs:{id:"_1-ec2에-프로젝트-clone-받기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-ec2에-프로젝트-clone-받기","aria-hidden":"true"}},[a._v("#")]),a._v(" 1. EC2에 프로젝트 Clone 받기")]),a._v(" "),s("p",[a._v("먼저 깃허브에서 코드를 받아올 수 있게 EC2에 깃을 설치해야한다.")]),a._v(" "),s("p",[a._v("EC2로 접속해서 다음과 같이 명령어를 입력합니다.")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("git 설치")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo yum install git\n")])])]),s("p",[s("code",[a._v("git 버전 확인")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("git --version\n")])])]),s("p",[s("code",[a._v("프로젝트 디렉토리 생성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mkdir ~/app && mkdir ~/app/step1\n")])])]),s("p",[s("code",[a._v("프로젝트 디렉트리 이동")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd ~/app/step1\n")])])]),s("p",[s("code",[a._v("git clone")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("git clone 주소\n")])])]),s("p",[s("img",{attrs:{src:t(288),width:"100%",height:"100%",title:"git clone",alt:"git clone"}}),s("br"),a._v(" "),s("code",[a._v("프로젝트 확인")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd 프로젝트명\nll\n")])])]),s("p",[s("img",{attrs:{src:t(289),width:"100%",height:"100%",title:"ll",alt:"ll"}}),s("br")]),a._v(" "),s("p",[s("code",[a._v("단위 테스트만 수행")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./gradlew test\n")])])]),s("p",[s("code",[a._v("실행 결과")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(290),width:"100%",height:"100%",title:"gradlew",alt:"gradlew"}}),s("br"),a._v(" "),s("code",[a._v("실행 권한 추가")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("chmod +x ./gradlew\n")])])]),s("p",[s("code",[a._v("단위 테스트만 수행")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./gradlew test\n")])])]),s("p",[s("img",{attrs:{src:t(291),width:"100%",height:"100%",title:"gradlew",alt:"gradlew"}}),s("br"),a._v("\n현재 ec2엔 그레이들(Gradle)을 설치하지 않았습니다. 하지만 Gradle Task(test)를 수행 할 수 있습니다. 이는 프로젝트 내부에 포함된 gradlew 파일 때문입니다.")])]),a._v(" "),s("h2",{attrs:{id:"_2-배포-스크립트-만들기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-배포-스크립트-만들기","aria-hidden":"true"}},[a._v("#")]),a._v(" 2. 배포 스크립트 만들기")]),a._v(" "),s("ol",[s("li",[a._v("git clone 혹은 git pull을 통해 새 버전의 프로젝트 받음")]),a._v(" "),s("li",[a._v("Gradle이나 Maven을 통해 프로젝트 테스트와 빌드")]),a._v(" "),s("li",[a._v("EC2 서버에서 해당 프로젝트 실행 및 재실행")])]),a._v(" "),s("p",[a._v("이 3가지에 대해서 쉘스크립트를 작성하겠습니다.")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("deploy.sh 생성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vim ~/app/step1/deploy.sh\n")])])]),s("p",[s("code",[a._v("deploy.sh 작성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('#!/bin/bash\n\nREPOSITORY=/home/ec2-user/app/step1\nPROJECT_NAME=springboot-webservice\n\ncd $REPOSITORY/$PROJECT_NAME/\n\necho "> Git Pull"\n\ngit pull\n\necho "> 프로젝트 Build 시작"\n\n./gradlew build\n\necho "> step1 디렉토리 이동"\n\ncd $REPOSITORY\n\necho "> Build 파일 복사"\n\ncp $REPOSITORY/$PROJECT_NAME/build/libs/*.jar $REPOSITORY/\n\necho "> 현재 구동중인 애플리케이션 pid 확인"\n\nCURRENT_PID=$(pgrep -f ${PROJECT_NAME}*.jar)\n\necho "현재 구동 중인 애플리케이션 pid: $CURRENT_PID"\n\nif [ -z "$CURRENT_PID" ]; then\n   echo "> 현재 구동 중인 애플리케이션이 없으므로 종료하지 않습니다."\nelse\n   echo "> kill -15 $CURRENT_PID"\n   kill -15 $CURRENT_PID\n   sleep 5\nfi\n\necho "> 새 애플리케이션 배포"\n\nJAR_NAME=$(ls -tr $REPOSITORY/ | grep *.jar | tail -n 1)\n\necho "> JAR Name: $JAR_NAME"\n\nnohup java -jar $REPOSITORY/$JAR_NAME 2>&1 &\n')])])])]),a._v(" "),s("h4",{attrs:{id:"코드-설명"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#코드-설명","aria-hidden":"true"}},[a._v("#")]),a._v(" 코드 설명")]),a._v(" "),s("ol",[s("li",[s("strong",[a._v("변수 지정")]),a._v(" "),s("ul",[s("li",[a._v("프로젝트 디렉토리 주소는 스크립트 내에서 자주 사용하는 값이 때문에 변수 지정")]),a._v(" "),s("li",[a._v("REPOSITORY=/home/ec2-user/app/step1")]),a._v(" "),s("li",[a._v("PROJECT_NAME=springboot-webservice")]),a._v(" "),s("li",[a._v("쉘에서는 타입 ㅇ벗이 선언하여 지정합니다.")]),a._v(" "),s("li",[a._v("쉘에서는 $ 변수명으로 변수를 사용할 수 있습니다.")])])]),a._v(" "),s("li",[s("strong",[a._v("git pull")]),a._v(" "),s("ul",[s("li",[a._v("master 브랜치의 최신 내용을 받습니다.")])])]),a._v(" "),s("li",[s("strong",[a._v("./gradlew build")]),a._v(" "),s("ul",[s("li",[a._v("프로젝트 내부의 gradlew로 build를 수행합니다.")])])]),a._v(" "),s("li",[s("strong",[a._v("CURRENT_PID=$(pgrep -f ${PROJECT_NAME}*.jar)")]),a._v(" "),s("ul",[s("li",[a._v("기존에 수행 중이던 스프링 부트 process id 추출 명령어")]),a._v(" "),s("li",[a._v("-f 옵션은 프로세스 이름으로 찻습니다.")])])]),a._v(" "),s("li",[a._v("*"),s("em",[a._v("JAR_NAME=$(ls -tr $REPOSITORY/ | grep "),s("em",[a._v(".jar | tail -n 1)")])]),a._v(" "),s("ul",[s("li",[a._v("새로 실행할 jar 파일명을 찾습니다.")]),a._v(" "),s("li",[a._v("여러 jar 파일이 생기기 때문에 tail -n로 가장 나중의 jar파일을 변수에 저장합니다.")])])]),a._v(" "),s("li",[s("strong",[a._v("nohup java -jar $REPOSITORY/$JAR_NAME 2>&1 &")]),a._v(" "),s("ul",[s("li",[a._v("찾은 jar 파일명으로 해당 jar파일을 nohup으로 실행합니다.")]),a._v(" "),s("li",[a._v("스프링 부트의 장점으로 특별히 외장 톰캣을 설치할 필요가 없습니다.")]),a._v(" "),s("li",[a._v("내장 톰캣을 사용해서 jar 파일만 있으면 바로 웹 애플리케이션 서버를 실행할 수 있습니다.")]),a._v(" "),s("li",[a._v("nohup으로 실행을 시키려면 실행파일 권한이 755이상으로 되어있어야 함")]),a._v(" "),s("li",[a._v("명령어 뒤에 '&'를 추가하면 백그라운드로 실행됨")]),a._v(" "),s("li",[a._v("nohup 을 통해 프로그램을 실행시키면 nohup.log 라는 로그 파일 생성")])])])]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("deploy.sh 실행 권한 추가")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("chmod +x ./deploy.sh\n")])])]),s("p",[s("img",{attrs:{src:t(292),width:"100%",height:"100%",title:"deploy.sh",alt:"deploy.sh"}}),s("br")]),a._v(" "),s("p",[s("code",[a._v("deploy.sh 실행")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./deploy.sh\n")])])]),s("p",[s("img",{attrs:{src:t(293),width:"100%",height:"100%",title:"deploy.sh",alt:"deploy.sh"}}),s("br")])]),a._v(" "),s("p",[a._v("배포 스크립트가 잘 실행되는 것을 볼 수 있다.")]),a._v(" "),s("h2",{attrs:{id:"_3-외부-security-파일-등록"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-외부-security-파일-등록","aria-hidden":"true"}},[a._v("#")]),a._v(" 3. 외부 Security 파일 등록")]),a._v(" "),s("p",[a._v("oauth 관련 proerties를 작성하자")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("application-oauth.properties 작성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vim /home/ec2-user/app/application-oauth.properties\n")])])]),s("p",[a._v("로컬에 있는 application-oauth.properties 파일 내용 그대로 붙여넣기를 합니다.\n"),s("code",[a._v("deploy.sh 파일 수정")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("...\nnohup java -jar \\ \n   -Dspring.config.location=classpath:/application.properties,/home/ec2-user/app/application-oauth.properties \\ \n$JAR_NAME > $REPOSITORY/$JAR_NAME 2>&1 &\n")])])])]),a._v(" "),s("h4",{attrs:{id:"코드설명"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#코드설명","aria-hidden":"true"}},[a._v("#")]),a._v(" 코드설명")]),a._v(" "),s("ol",[s("li",[s("strong",[a._v("-Dspring.config.location")]),a._v(" "),s("ul",[s("li",[a._v("스프링 설정 파일 위치를 지정합니다.")]),a._v(" "),s("li",[a._v("classpath가 붙으면 jar 안에 있는 resources 디렉트리 기준으로 경로가 생성됩니다.")]),a._v(" "),s("li",[a._v("application-oauth.properties은 절대경로를 사용합니다.")])])])]),a._v(" "),s("h2",{attrs:{id:"_4-스프링-부트-프로젝트로-rds-접근하기"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-스프링-부트-프로젝트로-rds-접근하기","aria-hidden":"true"}},[a._v("#")]),a._v(" 4. 스프링 부트 프로젝트로 RDS 접근하기")]),a._v(" "),s("ol",[s("li",[a._v("테이블 생성 : H2에서 자동 생성해주던 테이블들을 MariaDB에선 직접 쿼리를 이용")]),a._v(" "),s("li",[a._v("프로젝트 설정: MariaDB 드라이버 설정")]),a._v(" "),s("li",[a._v("EC2설정")])]),a._v(" "),s("h3",{attrs:{id:"rds-테이블-생성"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#rds-테이블-생성","aria-hidden":"true"}},[a._v("#")]),a._v(" RDS 테이블 생성")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("테이블 생성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("Hibernate: create table posts (id bigint not null auto_increment, create_date datetime, modified_date datetime, author varchar(255), content TEXT not null, title varchar(500) not null, primary key (id)) engine=InnoDB\nHibernate: create table user (id bigint not null auto_increment, create_date datetime, modified_date datetime, email varchar(255) not null, name varchar(255) not null, picture varchar(255), role varchar(255) not null, primary key (id)) engine=InnoDB\n")])])]),s("p",[s("code",[a._v("스프링 세션 테이블")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("CREATE TABLE SPRING_SESSION (\n\tPRIMARY_ID CHAR(36) NOT NULL,\n\tSESSION_ID CHAR(36) NOT NULL,\n\tCREATION_TIME BIGINT NOT NULL,\n\tLAST_ACCESS_TIME BIGINT NOT NULL,\n\tMAX_INACTIVE_INTERVAL INT NOT NULL,\n\tEXPIRY_TIME BIGINT NOT NULL,\n\tPRINCIPAL_NAME VARCHAR(100),\n\tCONSTRAINT SPRING_SESSION_PK PRIMARY KEY (PRIMARY_ID)\n) ENGINE=InnoDB ROW_FORMAT=DYNAMIC;\n\nCREATE UNIQUE INDEX SPRING_SESSION_IX1 ON SPRING_SESSION (SESSION_ID);\nCREATE INDEX SPRING_SESSION_IX2 ON SPRING_SESSION (EXPIRY_TIME);\nCREATE INDEX SPRING_SESSION_IX3 ON SPRING_SESSION (PRINCIPAL_NAME);\n\nCREATE TABLE SPRING_SESSION_ATTRIBUTES (\n\tSESSION_PRIMARY_ID CHAR(36) NOT NULL,\n\tATTRIBUTE_NAME VARCHAR(200) NOT NULL,\n\tATTRIBUTE_BYTES BLOB NOT NULL,\n\tCONSTRAINT SPRING_SESSION_ATTRIBUTES_PK PRIMARY KEY (SESSION_PRIMARY_ID, ATTRIBUTE_NAME),\n\tCONSTRAINT SPRING_SESSION_ATTRIBUTES_FK FOREIGN KEY (SESSION_PRIMARY_ID) REFERENCES SPRING_SESSION(PRIMARY_ID) ON DELETE CASCADE\n) ENGINE=InnoDB ROW_FORMAT=DYNAMIC;\n")])])])]),a._v(" "),s("h3",{attrs:{id:"프로젝트-설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#프로젝트-설정","aria-hidden":"true"}},[a._v("#")]),a._v(" 프로젝트 설정")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("build.gradle")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('compile("org.mariadb.jdbc:mariadb-java-client")\n')])])]),s("p",[s("code",[a._v("운영 application-real.properties 작성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("spring.profiles.include=oauth,real-db\nspring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL5InnoDBDialect\nspring.session.store-type=jdbc\n")])])])]),a._v(" "),s("h3",{attrs:{id:"ec2-설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#ec2-설정","aria-hidden":"true"}},[a._v("#")]),a._v(" EC2 설정")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("운영 application-real-db.properties 생성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vim ~/app/application-real-db.properties\n")])])]),s("p",[s("code",[a._v("운영 application-real-db.properties 작성")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("spring.jpa.hibernate.ddl-auto=none\n\nspring.datasource.url=jdbc:mariadb://rds주소:포트명(기본은 3306)/database명\nspring.datasource.username=db계정\nspring.datasource.password=db계정 비밀번호\nspring.datasource.driver-class-name=org.mariadb.jdbc.Driver\n")])])])]),a._v(" "),s("h4",{attrs:{id:"코드설명-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#코드설명-2","aria-hidden":"true"}},[a._v("#")]),a._v(" 코드설명")]),a._v(" "),s("ol",[s("li",[s("strong",[a._v("spring.jpa.hibernate.ddl-auto=none")]),a._v(" "),s("ul",[s("li",[a._v("JPA로 테이블이 자동 생성되는 옵션을 None(생성하지 않음)으로 지정")]),a._v(" "),s("li",[a._v("RDS에는 실제 운영으로 사용될 테이블이니 절대 스프링 부트에서 새로 만들지 않도록 해야 합니다.")]),a._v(" "),s("li",[a._v("이 옵션을 하지 않으면 자칫 테이블이 모두 새로 생성될 수 있습니다.")]),a._v(" "),s("li",[a._v("주의해야 하는 옵션입니다.")])])])]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("deploy.sh 수정")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("...\nnohup java -jar \\\n   -Dspring.config.location=classpath:/application.properties,classpath:/application-real.properties,/home/ec2-user/app/application-oauth.properties,/home/ec2-user/app/application-real-db.properties \\\n   -Dspring.profiles.active=real \\\n   $JAR_NAME > $REPOSITORY/nohup.out 2>&1 &\n")])])]),s("p",[s("code",[a._v("deploy.sh 재실행")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("./deploy.sh\n")])])]),s("p",[s("code",[a._v("curl localhost:8080 확인")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(294),width:"100%",height:"100%",title:"deploy.sh",alt:"deploy.sh"}}),s("br")])]),a._v(" "),s("h2",{attrs:{id:"_5-ec2에서-소셜-로그인-설정"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-ec2에서-소셜-로그인-설정","aria-hidden":"true"}},[a._v("#")]),a._v(" 5. EC2에서 소셜 로그인 설정")]),a._v(" "),s("h4",{attrs:{id:"aws-보안-그룹-변경"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aws-보안-그룹-변경","aria-hidden":"true"}},[a._v("#")]),a._v(" AWS 보안 그룹 변경")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("EC2 보안 그룹 체크")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(295),width:"100%",height:"100%",title:"보안",alt:"보안"}}),s("br")])]),a._v(" "),s("h4",{attrs:{id:"aws-ec2-도메인으로-접속"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#aws-ec2-도메인으로-접속","aria-hidden":"true"}},[a._v("#")]),a._v(" AWS EC2 도메인으로 접속")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("EC2 퍼블릭 DNS 확인")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(296),width:"80%",height:"100%",title:"DNS",alt:"DNS"}}),s("br"),a._v(" "),s("code",[a._v("EC2 퍼블릭 DNS 접속")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(297),width:"100%",height:"100%",title:"DNS",alt:"DNS"}}),s("br")])]),a._v(" "),s("h4",{attrs:{id:"구글-ec2-주소-등록"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#구글-ec2-주소-등록","aria-hidden":"true"}},[a._v("#")]),a._v(" 구글 EC2 주소 등록")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("OAuth 동의 화면 승인된 도메인 등록")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(298),width:"80%",height:"100%",title:"DNS",alt:"DNS"}}),s("br"),a._v(" "),s("code",[a._v("사용자 인증 정보 추가")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(299),width:"80%",height:"100%",title:"DNS",alt:"DNS"}}),s("br"),a._v(" "),s("code",[a._v("EC2에서 구글 로그인 성공")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(300),width:"80%",height:"100%",title:"Google",alt:"Google"}}),s("br")])]),a._v(" "),s("h4",{attrs:{id:"네이버-ec2-주소-등록"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#네이버-ec2-주소-등록","aria-hidden":"true"}},[a._v("#")]),a._v(" 네이버 EC2 주소 등록")]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("네이버 애플리케이션 설정")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(301),width:"80%",height:"100%",title:"Naver",alt:"Naver"}}),s("br")])]),a._v(" "),s("ol",[s("li",[a._v("서비스 URL\n"),s("ul",[s("li",[a._v("로그인을 시도하는 서비스가 네이버에 등록된 서비스인지 판단하기 위한 항목")]),a._v(" "),s("li",[a._v("포트 제외하고 실제 도메인 주소만 입력합니다.")]),a._v(" "),s("li",[a._v("네이버에서 아직 지원되지 않아 하나만 등록 가능합니다.")])])]),a._v(" "),s("li",[a._v("Callback URL\n"),s("ul",[s("li",[a._v("전체 주소를 등록합니다.(EC2 퍼블릭 DNS:8080/login/oauth2/code/naver)")])])])]),a._v(" "),s("blockquote",[s("p",[s("code",[a._v("EC2에서 네이버 로그인 성공")])]),a._v(" "),s("p",[s("img",{attrs:{src:t(302),width:"80%",height:"100%",title:"Naver",alt:"Naver"}}),s("br")])])])}],r=t(0),l=Object(r.a)({},(function(){var a=this.$createElement;this._self._c;return this._m(0)}),s,!1,null,null,null);e.default=l.exports}}]);